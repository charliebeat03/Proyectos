<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chat Simple</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
        }
        
        .chat-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
            word-break: break-word;
        }
        
        .my-message {
            align-self: flex-end;
            background: #DCF8C6;
            border-bottom-right-radius: 3px;
        }
        
        .other-message {
            align-self: flex-start;
            background: #E8E8E8;
            border-bottom-left-radius: 3px;
        }
        
        .input-area {
            padding: 15px;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
        }
        
        input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        button {
            background: #25D366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .error {
            color: red;
            text-align: center;
            padding: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="messages" id="messages"></div>
        <div class="error" id="errorMsg">⚠️ Error enviando mensaje</div>
        <div class="input-area">
            <input type="text" id="messageInput" placeholder="Escribe tu mensaje...">
            <button onclick="sendMessage()">Enviar</button>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC2uxNfdKnlsZ-eh0AKdI5WDrPYtF94njw",
            authDomain: "whatschism.firebaseapp.com",
            projectId: "whatschism",
            storageBucket: "whatschism.firebasestorage.app",
            messagingSenderId: "585388627265",
            appId: "1:585388627265:web:6c4574ea5ad9a87fa77dc0",
            measurementId: "G-JSF25M3Z6J"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Función de envío mejorada
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const errorMsg = document.getElementById('errorMsg');
            const message = input.value.trim();
            
            if(!message) {
                input.focus();
                return;
            }
            
            try {
                await db.collection('messages').add({
                    text: message,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    sender: 'yo' // Identificador fijo
                });
                input.value = '';
                errorMsg.style.display = 'none';
            } catch (error) {
                console.error('Error:', error);
                errorMsg.style.display = 'block';
                setTimeout(() => errorMsg.style.display = 'none', 3000);
            }
        }

        // Escuchar mensajes
        db.collection('messages')
          .orderBy('timestamp')
          .onSnapshot(snapshot => {
              const messagesDiv = document.getElementById('messages');
              messagesDiv.innerHTML = '';
              
              snapshot.forEach(doc => {
                  const data = doc.data();
                  const messageClass = data.sender === 'yo' ? 'my-message' : 'other-message';
                  
                  const messageElement = document.createElement('div');
                  messageElement.className = `message ${messageClass}`;
                  messageElement.textContent = data.text;
                  
                  messagesDiv.appendChild(messageElement);
              });
              
              // Scroll automático
              messagesDiv.scrollTop = messagesDiv.scrollHeight;
          });

        // Verificación de Firestore
        db.collection('messages').get().catch(error => {
            alert(`¡Error de conexión! Verifica:\n1. Tu conexión a internet\n2. Reglas de Firestore (permitir lectura/escritura)`);
        });
    </script>
</body>
</html>
